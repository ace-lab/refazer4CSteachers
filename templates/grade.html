{% extends "show_editors.html" %}
{% block clusters %}
<div id='submissions_column' class="col-md-2">

  {% macro make_submission(question_number, i) %}
    <a href="/{{ question_number }}/{{ i }}" class="{{ 'selected-cluster' if i == submission_id }}">
      <li class="list-group-item submission{% if i in grade_status %} {{ grade_status[i] }}{% endif %}">
        Submission {{ i }}
        {% if i in graded_submission_ids %}
        <img class='inline' src='/static/img/check.svg' />
        {% elif i in fixed_submission_ids %}
        <img class='inline' src='/static/img/lightbulb.svg' />
        {% elif i in perfect_test_submission_ids %}
        <img class='inline' src='/static/img/star.svg' />
        {% endif %}
      </li>
    </a>
    <td class="line-number" data-line-number="{{ '' if i is none else i }}"></td>
  {% endmacro %}

  <h2 class='submission_header'>Submissions</h2>

  <div id='symbol_legend'>
    <p>
      <img class='inline' src='/static/img/lightbulb.svg' />
      = fix recommended<br/>
      <img class='inline' src='/static/img/star.svg' />
      = passed all test cases<br/>
      <img class='inline' src='/static/img/check.svg' />
      = graded
    </p>
  </div>

  <div id="submission_list" class='submission_list'>
    <ul class="list-group submission_order submission_ordering">
      {% for i in submission_ids %}
        {{ make_submission(question_number, i) }}
      {% endfor %}
    </ul>
    <ul class="simple_list test_case_order submission_ordering" style='display: none;'>
      {% for test_case_group in test_case_groups %}
      <li>
        <ul class="list-group">
          {% for i in test_case_group %}
            {{ make_submission(question_number, i) }}
          {% endfor %}
        </ul>
      </li>
      {% endfor %}
    </ul>
    {% if session.fixes_enabled %}
    <ul class="simple_list fix_order submission_ordering" style='display: none;'>
      {% for fix_group in fix_groups %}
      <li>
        <ul class="list-group">
          {% for i in fix_group %}
            {{ make_submission(question_number, i) }}
          {% endfor %}
        </ul>
      </li>
      {% endfor %}
    </ul>
    {% endif %}
  </div>
  <form id="order_form" class="ui form">
    <label>Order by:</label>
    <div class="order field">
      <div class="ui radio checkbox">
        <input checked=true name="sort_order" data-mode="submission_id" type="radio">
        <label>Submission IDs</label>
      </div>
    </div>
    <div class="order field">
      <div class="ui radio checkbox">
        <input checked=true name="sort_order" data-mode="test_case" type="radio">
        <label>Test case results</label>
      </div>
    </div>
    {% if session.fixes_enabled %}
    <div class="order field">
      <div class="ui radio checkbox">
        <input checked=true name="sort_order" data-mode="fix" type="radio">
        <label>Suggested fixes</label>
      </div>
    </div>
    {% endif %}
  </form>

  {% if session.fixes_enabled %}
  <h2 class='submission_header'>Grading suggestions</h2>
  <div id="fix_list" class='submission_list'>
    <ul id='synthesis_list' class="list-group">
      {% for i in fixed_submissions %}
        {{ make_submission(question_number, i) }}
      {% endfor %}
    </ul>
  </div>
  {% endif %}

</div>
<script>
$(function() {

    // Scroll the list to the selected element
    // REUSE: Based on tip at
    // http://stackoverflow.com/questions/2905867/how-to-scroll-to-specific-item-using-jquery
    function scrollList(list, sublist_selector) {
        var selector = 'a.selected-cluster';
        if (sublist_selector !== undefined) {
            selector = sublist_selector + ' ' + selector;
        }
        var selected = list.find(selector);
        if (selected.length > 0) {
            list.scrollTop(
                selected.offset().top - list.offset().top + list.scrollTop()
            );
        }
    }

    console.log("I'm here");
    $('#order_form .checkbox').checkbox({
        onChecked: function() {
            var order = $(this).data('mode');
            $('.submission_ordering').css('display', 'none');
            if (order === "submission_id") {
                $('ul.submission_order').css('display', 'block');
                scrollList($('div#submission_list'), 'ul.submission_order');
            } else if (order === "test_case") {
                $('ul.test_case_order').css('display', 'block');
                scrollList($('div#submission_list'), 'ul.test_case_order');
            } else if (order === "fix") {
                $('ul.fix_order').css('display', 'block');
                scrollList($('div#submission_list'), 'ul.fix_order');
            }
        }
    });

    $('input[type=radio][data-mode=submission_id]').prop('checked', true);
    scrollList($('div#submission_list'));
    scrollList($('div#synthesis_list'));

});
</script>
{% endblock %}
