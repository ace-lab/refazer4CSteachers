{% extends "show_fixes.html" %}

{% block clusters %}
<div class="col-md-3">

  <div class="progress" style="margin-top: 10px;">
    <div class="progress-bar" style="width: {{ (fixes|selectattr('tab_id', 'equalto', 2)|list|length / clusters|length * 100) | round | int
    }}%;">
    {{ (fixes|selectattr('tab_id', 'equalto', 2)|list|length / clusters|length * 100) | round | int }} %
    </div>
  </div>

  <div class="progress" style="margin-top: 10px;">
    <div class="progress-bar" style="width: {{ (fixes|selectattr('tab_id', 'equalto', 0)|list|length / clusters|length * 100) | round | int
    }}%;">
    {{ (fixes|selectattr('tab_id', 'equalto', 0)|list|length / clusters|length * 100) | round | int }} %
    </div>
  </div>

  <div class="ui form" style="margin-bottom: 10px">
    <div class="inline field">
      <div class="ui toggle checkbox">
        {% if current_filter == 'True' %}
          <input type="checkbox" tabindex="0" class="hidden" data-href="/{{question_number}}/{{tab_id}}/{{cluster_id}}" checked>
          <label>Filter: ON (Hide finished)</label>
          <style>
            .finished-cluster { display: none; }
          </style>
        {% else %}
          <input type="checkbox" tabindex="0" class="hidden" data-href="/{{question_number}}/{{tab_id}}/{{cluster_id}}?filter=True">
          <label>Filter: OFF (Show finished)</label>
        {% endif %}
      </div>
    </div>
  </div>

  <ul class="list-group">
    {% for i in range(clusters|length) %}
    <a href="/{{question_number}}/2/{{i}}">
      {% if cluster_id == i %}
                  <li class="list-group-item list-group-item-info">
                {% else %}
                  <li class="list-group-item">
                {% endif %}
        <!--<span class="badge">{{g['count']}}</span>-->
          <!-- Behavioral Misfire {{ g['group_id'] }} -->
        <span class="badge ui label label-size-{{ (clusters[i].size/10) | round | int }}">{{ clusters[i].size }}</span>
        <span class="notabadge">{% if (entries|selectattr("cluster_id", "equalto", i)|list|length) != 0 %} &#9989; {% else %} &#10008; {% endif %}</span>
                  <b>Cluster {{i}}</b></br>
                  <div style="border : 1px dotted; margin-top : 2px; padding: 2px; border-radius: 5px;">
{% for line in clusters[i].fixes[0].diff_lines %}
                    {% if line.tag == "insert" %}
                      <div class="highlight-source code">{{ line.contents | escape | truncate(45, True)}}</div>
                    {% elif line.tag == "delete" %}
                      <div class="highlight-source code">{{ line.contents | escape | truncate(45, True)}}</div>
                    {% elif line.tag == "replace" %}
                      <div class="highlight-source code">{{ line.contents | escape | truncate(45, True)}}</div>
                    {% endif %}
                  {% endfor %}
                  </div>
                  <div style="border : 1px dotted; margin-top : 2px; padding: 2px; border-radius: 5px;">
                     <span>test case</span>
        <span class="code">{{clusters[i].test[0]['input']}}</span>
        <br>
        <span>returned</span>
        <span class="code">{{clusters[i].test[0]['output']}}</span>
        <br>
        <span>instead of</span>
        <span class="code">{{clusters[i].test[0]['expected']}}</span>
                  </div>
        </li></a>
      {% endfor %}
  </ul>
</div>
{% endblock %}

{% block script %}
$("#rulextest-based-tab").addClass("active");
{% endblock %}